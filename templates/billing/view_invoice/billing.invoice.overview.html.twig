{% extends 'billing/view_invoice/invoice.base.html.twig' %}

{% set currentTab = 'overview' %}

{% block overview %}

	<div class="flex pt-6 pb-4 px-8 space-x-6">
		<div class="w-[656px] space-y-10">
{#			{% if data.invoice_description %}#}
			{% if getGet() != 'Pending' %}
			<div class="p-4 space-y-1 ring-1 ring-gray-200 rounded-lg">
				<div class="flex space-x-1">
					<p class="grow text-gray-400 text-xs font-medium">Описание</p>
					<p class="text-gray-400 text-xs font-medium text-right">Отображается клиенту</p>
				</div>
				<div class="text-sm">{{ data.invoice_description }}</div>
			</div>
			{% endif %}

			<div class="space-y-5">
				<h3 class="text-lg font-medium">Счёт</h3>
				<div class="w-full overflow-hidden ring-1 ring-gray-200 rounded-lg">
					<table class="w-full">
						<thead>
						<tr class="bg-gray-50 ring-b ring-1 ring-gray-300 text-sm font-medium">
							<th class="w-16 py-3 pl-6 pr-3 text-left">№</th>
							<th class="p-3 text-left truncate">Наименование услуги</th>
							<th class="w-[176px] py-3 pl-3 pr-6 text-right">Сумма</th>
						</tr>
						</thead>
						<tbody class="divide-y text-gray-500 text-sm">

						{% for i in services %}
							<tr>
								<td class="py-4 pl-6 pr-3">{{ i.id }}</td>
								<td class="py-4 px-3">{{ i.service }}</td>
								<td class="py-4 pl-3 pr-6 text-right">$ {{ i.amount|number_format('2', '.', '') }}</td>
							</tr>
						{% endfor %}
						</tbody>
					</table>

					<div class="flex ring-t ring-1 ring-gray-200 bg-gray-50">
						<div class="grow py-4 px-3 space-y-1 text-right">
							<p class="text-sm text-right">Без скидок:</p>
							<p class="text-sm text-right">Скидка:</p>
							<p class="text-sm text-right">Всего (без VAT):</p>
							<p class="text-sm text-right">VAT (20%):</p>
							<p class="text-sm text-right font-semibold">Итого:</p>
						</div>
						<div class="py-4 pl-3 pr-6 space-y-1">
							<p class="text-sm">$ {{ data.invoice_amount|number_format('2', '.', '') }}</p>

							<p class="text-sm">$ {{ data.invoice_discount|number_format('2', '.', '') }}</p>

							{% set total_without_vat = data.invoice_amount - data.invoice_discount - data.invoice_paid %}
							<p class="text-sm">$ {{ total_without_vat|number_format('2', '.', '') }}</p>

							<p class="text-sm">$ {{ data.invoice_vat|number_format('2', '.', '') }}</p>

							{% set total = data.invoice_amount - data.invoice_discount - data.invoice_paid + data.invoice_vat %}
							<p class="font-semibold text-sm">$ {{ total|number_format('2', '.', '') }}</p>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="flex-1 space-y-6">
			<div class="ring-1 ring-gray-200 rounded-lg divide-y overflow-hidden">
				<div class="py-3 px-6 bg-gray-50 text-sm font-medium">Общая информация</div>
				<div class="flex py-3 px-6 space-x-4">
					<div class="grow text-gray-700 text-sm">Имя клиента</div>
					<div class="text-sm font-medium text-right">
						<a href="{{ path('profile') }}" class="hover:text-indigo-700">{{ data.invoice_user }}</a>
					</div>
				</div>
				<div class="flex py-3 px-6 space-x-4">
					<div class="grow text-gray-700 text-sm">ID услуги</div>
					<div class="text-indigo-700 text-sm font-medium text-right">{{ data.invoice_service_id }}</div>
				</div>
				<div class="flex py-3 px-6 space-x-4">
					<div class="grow text-gray-700 text-sm">Дата выставления</div>
					<div class="text-sm font-medium text-right">{{ data.invoice_issued }}</div>
				</div>
				<div class="flex py-3 px-6 space-x-4">
					<div class="grow text-gray-700 text-sm">Срок оплаты</div>
					<div class="text-sm font-medium text-right">{{ data.invoice_paydate }}</div>
				</div>
				<div class="flex py-3 px-6 space-x-4">
					<div class="grow text-gray-700 text-sm">Всего (без VAT)</div>
					<div class="text-sm font-medium text-right">$ {{ total_without_vat|number_format(2, '.', '') }}</div>
				</div>
				<div class="flex py-3 px-6 space-x-4">
					<div class="grow text-gray-700 text-sm">VAT (20%)</div>
					<div class="text-sm font-medium text-right">$ {{ data.invoice_vat|number_format(2, '.', '') }}</div>
				</div>
				<div class="flex py-3 px-6 space-x-4 bg-gray-50">
					<div class="grow text-gray-700 text-sm font-semibold">Итого</div>
					<div class="text-sm font-semibold text-right">$ {{ total|number_format(2, '.', '') }}</div>
				</div>
				<div class="flex py-3 px-6 space-x-4">
					<div class="grow text-gray-700 text-sm">Оплачено</div>
					<div class="text-sm font-medium text-right">{{ data.invoice_paid|number_format(2, '.', '') }}</div>
				</div>
				<div class="flex py-3 px-6 space-x-4">
					<div class="grow text-gray-700 text-sm">Доплатить</div>
					<div class="text-sm font-medium text-right">{{ (total - data.invoice_paid)|number_format(2, '.', '') }}</div>
				</div>
				<div class="flex py-3 px-6 space-x-4">
					<div class="grow text-gray-700 text-sm">Статус инвойса</div>
					<div class="text-right">
						{% if getGet() %}
							{% for val, css in invoice_statuses %}
								{% if val == getGet() %}
									<span class="py-0.5 px-3 rounded-xl text-sm font-medium bg-{{ css }}-100 text-{{ css }}-800">{{ val }}</span>
								{% endif %}
							{% endfor %}
						{% else %}
							<span class="py-0.5 px-3 rounded-xl text-sm font-medium bg-green-100 text-green-800">Paid</span>
						{% endif %}
					</div>
				</div>
				<div class="flex py-3 px-6 space-x-4">
					<div class="grow text-gray-700 text-sm">Дата последней оплаты</div>
					<div class="text-sm font-medium text-right"></div>
				</div>
				<div class="flex py-3 px-6 space-x-4">
					<div class="grow text-gray-700 text-sm">Способ оплаты</div>
					<div class="text-sm font-medium text-right"></div>
				</div>
			</div>

			<div class="space-y-4">
				<h3 class="text-lg font-medium">Примечание</h3>
				<div class="p-4 space-y-1 ring-1 ring-gray-200 rounded-lg bg-yellow-50">
					<p class="text-gray-400 text-xs font-medium">Примечание</p>
					<textarea class="w-full p-0 border-0 bg-yellow-50 rounded-md text-sm resize-none focus:bg-white">{{ data.invoice_notation }}</textarea>
				</div>
			</div>
		</div>
	</div>

{% endblock %}

{% block modals %}
	{{ parent() }}
{% endblock %}

